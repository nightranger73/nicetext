#!/bin/bash

# default values
FONT="Ubuntu-Bold"
MESSAGE="Welcome, $USER"
COLOR_SCHEME="sky"
SIZE="72"

# --- Checking for installed tools ---
if ! command -v magick &> /dev/null || ! command -v chafa &> /dev/null; then
    echo "Error: You need both 'imagemagick' and 'chafa' on your system."
    exit 1
fi

# --- Help function ---
usage() {
    echo "Usage: $0 [OPTIONS]"
    echo ""
    echo "Options:"
    echo "  -f FONT          Font Name (example: 'DejaVu-Sans-Bold')"
    echo "  -m MESSAGE       Text to output"
    echo "  -c COLOR         Color scheme: sky (def), fire, forest, neon, sunset, ocean, cyberpunk"
    echo "  -s SIZE          Font Size in points (def: 72)"
    echo "  -h               Show this help"
    exit 1
}

# --- Parsing arguments ---
while getopts "f:m:c:s:h" opt; do
    case $opt in
        f) FONT="$OPTARG" ;;
        m) MESSAGE="$OPTARG" ;;
        c) COLOR_SCHEME="$OPTARG" ;;
        s) SIZE="$OPTARG" ;;
        h|*) usage ;;
    esac
done

# --- Gradients ---
# Barycentric: 0,0 (top-left) | %[fx:w],0 (top-right) | %[fx:w],%[fx:h] (bottom-right)
case $COLOR_SCHEME in
    fire) 
        GRADIENT="0,0 #ff8c00 %[fx:w],0 #ff0000 %[fx:w],%[fx:h] #8b0000" 
        ;;
    forest) 
        GRADIENT="0,0 #90ee90 %[fx:w],0 #228b22 %[fx:w],%[fx:h] #006400" 
        ;;
    neon)   
        GRADIENT="0,0 #00ffff %[fx:w],0 #ff00ff %[fx:w],%[fx:h] #ffff00" 
        ;;
    sunset) 
        GRADIENT="0,0 #ff5e62 %[fx:w],0 #ff9966 %[fx:w],%[fx:h] #ff5e62" 
      ;;
    ocean) 
        GRADIENT="0,0 #2193b0 %[fx:w],0 #6dd5ed %[fx:w],%[fx:h] #2193b0" 
      ;;
    cyberpunk) 
        GRADIENT="0,0 #ff00ff %[fx:w],0 #00ffff %[fx:w],%[fx:h] #0000ff" 
      ;;
    sky|*)  
        GRADIENT="0,0 white %[fx:w],0 #87CEEB %[fx:w],%[fx:h] #800080" 
        ;;
esac

# --- Create text as image ---
magick -background none -pointsize "$SIZE" -font "$FONT" \
    label:"$MESSAGE" \
    \( +clone -sparse-color Barycentric "$GRADIENT" \) \
    -compose In -composite \
    -define png:exclude-chunks=bKGD png:- | chafa --format kitty -
